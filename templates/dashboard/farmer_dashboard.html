<div class="card weather-widget">
    <h3>Forecast for {{ weather.location }}</h3>
    <div style="display: flex; align-items: center; justify-content: space-between;">
        <div style="font-size: 3rem;">
            {% if weather.condition == "Sunny" %}â˜€ï¸
            {% elif weather.condition == "Rainy" %}ğŸŒ§ï¸
            {% elif weather.condition == "Cloudy" %}â˜ï¸
            {% else %}â›…{% endif %}
        </div>
        <div style="text-align: right;">
            <div style="font-size: 2rem; font-weight: bold;">{{ weather.temperature }}Â°C</div>
            <div>{{ weather.condition }}</div>
            <div>Rain Chance: {{ weather.rain_chance }}%</div>
        </div>
    </div>
    <div style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.9;">
        Today, {{ weather.date }}
    </div>
</div>

<div class="grid">
    <div class="card">
        <h3>ğŸ’° Market Prices</h3>
        <div class="market-list">
            {% for item in market_prices %}
            <div class="market-row">
                <div>
                    <strong>{{ item.crop }}</strong>
                    <div class="muted">Per unit price</div>
                </div>
                <div class="market-price-tag">KES {{ item.price }}</div>
                <div class="{% if '+' in item.change %}market-change-up{% else %}market-change-down{% endif %}">
                    {{ item.change }}
                </div>
            </div>
            {% endfor %}
        </div>
        <a href="{% url 'marketplace' %}" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Open
            Marketplace</a>
    </div>

    <div class="card">
        <h3>ğŸ’¡ Daily Farming Tip</h3>
        <p style="font-style: italic; font-size: 1.1rem; color: #555;">"{{ farming_tip }}"</p>
        <hr style="border: 0; border-top: 1px solid #eee; margin: 1rem 0;">
        <h4>Actions</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <a href="{% url 'reports' %}" class="btn btn-secondary">My Reports</a>
            <a href="{% url 'download_data' %}" class="btn btn-secondary">Download Data</a>
        </div>
        <h4>Quick Links</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
            <a href="{% url 'loan_request' %}" class="btn btn-accent">Request Loan</a>
            <a href="{% url 'insurance_apply' %}" class="btn btn-secondary" style="background-color: #555;">Insure
                Crops</a>
        </div>
        <div style="margin-top: 0.5rem;">
            <a href="{% url 'financial_literacy' %}" class="btn btn-primary"
                style="width: 100%; background-color: #0288D1; margin-bottom: 0.5rem;">Financial Tips</a>
            <a href="{% url 'marketplace' %}" class="btn btn-accent" style="width: 100%; margin-bottom: 0.5rem;">Sell
                Produce</a>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                <a href="{% url 'policy_list' %}" class="btn btn-secondary"
                    style="text-align: center; font-size: 0.9rem;">Policy Center</a>
                <a href="{% url 'service_locator' %}" class="btn btn-secondary"
                    style="text-align: center; font-size: 0.9rem;">Find Services</a>
                <a href="{% url 'extension_groups' %}" class="btn btn-secondary"
                    style="text-align: center; font-size: 0.9rem;">Farmer Groups</a>
                <a href="{% url 'extension_traceability' %}" class="btn btn-secondary"
                    style="text-align: center; font-size: 0.9rem;">Traceability</a>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <h3>ğŸ“Š Yield History (Bags/Acre)</h3>
    <canvas id="yieldChart"></canvas>
</div>

<div class="card">
    <h3>ğŸŒ Languages</h3>
    <p>Content available in English and Swahili. Ask support to request another language.</p>
</div>

<div class="card">
    <h3>ğŸ¤ Extension Support</h3>
    <p>Send questions to extension officers and get tailored advice.</p>
    <div class="stacked">
        <a href="{% url 'extension_ask' %}" class="btn btn-secondary">Ask an Expert</a>
        <a href="{% url 'extension_groups' %}" class="btn btn-secondary">Find Farmer Groups</a>
        <a href="{% url 'extension_traceability' %}" class="btn btn-secondary">My Traceability Records</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('yieldChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['2023 Season 1', '2023 Season 2', '2024 Season 1', '2024 Season 2'],
            datasets: [{
                label: 'Maize Yield (Bags)',
                data: [12, 19, 15, 22],
                backgroundColor: 'rgba(46, 125, 50, 0.6)',
                borderColor: 'rgba(46, 125, 50, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>